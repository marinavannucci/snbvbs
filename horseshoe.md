## Horseshoe Shrinkage MCMC

We would like to see whether adaptive shrinkage prior such as Horseshoe has better performance in variable selection under the negative binomial model. Recall that the hierarchical model
with the horseshoe prior on <img alt="$\boldsymbol{\beta}$" src="svgs/b40aa6b23d5447452eba56d9bda8960d.svg" align="middle" width="11.404140000000002pt" height="22.831379999999992pt"/> is 
<p align="center"><img alt="$$&#10;\begin{align}&#10;\left[\beta_{k}\mid\lambda_{k}\right] &amp; \overset{\text{indep}}{\sim}\text{Normal}\left(0,\lambda_{k}^{2}\right),\\&#10;\left[\lambda_{k}\mid A\right] &amp; \overset{\text{iid}}{\sim}C^{+}\left(0,A\right),\\&#10;A &amp; \sim\text{Uniform}\left(0,10\right),&#10;\end{align}&#10;$$" src="svgs/d31a0e5eb96b94e7cc391b1927e2e4ee.svg" align="middle" width="210.16049999999998pt" height="78.2991pt"/></p>
where <img alt="$\beta_{k}$" src="svgs/6b8eb3c8636d63d430331d2745c5a886.svg" align="middle" width="16.564020000000003pt" height="22.831379999999992pt"/> is adaptively shrunken by <img alt="$\lambda_{k}$" src="svgs/cf39565086d308d92ed10730aba2a5bf.svg" align="middle" width="16.855245000000004pt" height="22.831379999999992pt"/> whose distribution is an independent identical half-Cauchy distribution (iid) and <img alt="$A$" src="svgs/53d147e7f3fe6e47ee05b88b166bd3f6.svg" align="middle" width="12.328800000000005pt" height="22.46574pt"/> controls the global level of shrinkage. We can rewrite the Horseshoe prior using the following parameter expansion:
<p align="center"><img alt="$$&#10;\begin{align*}&#10;\left[\beta_{k}\mid\eta_{k}\right] &amp; \overset{\text{indep}}{\sim}\text{Normal}\left(0,\eta_{k}^{-1}\right),\\&#10;\left[\eta_{k}\mid\gamma_{k}\right] &amp; \overset{\text{indep}}{\sim}\text{Gamma}\left(\frac{1}{2},\gamma_{k}\right),\\&#10;\left[\gamma_{k}\mid\tau_{A}\right] &amp; \overset{\text{indep}}{\sim}\text{Gamma}\left(\frac{1}{2},\tau_{A}\right),\\&#10;\tau_{A} &amp;\sim\text{Gamma}_{\left[0.01,\infty\right)}\left(-\frac{1}{2},0\right).&#10;\end{align*}&#10;$$" src="svgs/1a99a4ec5e6c3e4c3220f87fe013f70d.svg" align="middle" width="260.94915000000003pt" height="162.08675999999997pt"/></p>


where we note that <img alt="$\eta_{k}=\lambda_{k}^{-2}$" src="svgs/c9b8c16cb3047ddfa5750f3d3bbab05b.svg" align="middle" width="64.58347499999999pt" height="28.89513000000001pt"/>, <img alt="$\tau_{A}=A^{-2}$" src="svgs/4d042d969296cb125fe48836a271ac18.svg" align="middle" width="68.96703pt" height="26.76201000000001pt"/> and <img alt="$\tau_{A}$" src="svgs/7f66c79ccfda0e9ea18d262c5b47afaa.svg" align="middle" width="17.072055000000002pt" height="14.155350000000013pt"/> follows a truncated Gamma distribution. The posterior distribution for all parameters of interests is as follows where we again eliminate the additive effect of the intercept by integrating it out of the posterior distribution 
<p align="center"><img alt="$$&#10;p\left(\boldsymbol{\beta},\beta_{0},\boldsymbol{\eta},\boldsymbol{\gamma},\tau_{A}\mid\boldsymbol{X},\boldsymbol{y},r,\boldsymbol{\omega}\right)\propto p\left(\boldsymbol{y}\mid\boldsymbol{\psi},\boldsymbol{\omega},r\right)p\left(\boldsymbol{\beta}\mid\boldsymbol{\eta}\right)p\left(\boldsymbol{\eta}\mid\boldsymbol{\gamma}\right)p\left(\boldsymbol{\gamma}\mid\tau_{A}\right)p\left(\tau_{A}\right)p\left(\beta_{0}\right),&#10;$$" src="svgs/65a65f26ec75145990ad49f1a09368a6.svg" align="middle" width="607.43265pt" height="16.438356pt"/></p>

<p align="center"><img alt="$$&#10;\int p\left(\boldsymbol{y}\mid\boldsymbol{\psi},\boldsymbol{\omega},r\right)p\left(\beta_{0}\right)d\beta_{0}\propto\frac{1}{\sqrt{\bar{\boldsymbol{\omega}}}}\exp\left(\frac{\bar{\boldsymbol{\kappa}}^{2}}{2\bar{\boldsymbol{\omega}}}\right)\exp\left(\hat{\boldsymbol{\kappa}}^{T}\boldsymbol{X}\boldsymbol{\beta}-\frac{1}{2}\boldsymbol{\beta}^{T}\boldsymbol{X}^{T}\hat{\boldsymbol{\Omega}}\boldsymbol{X}\boldsymbol{\beta}\right),&#10;$$" src="svgs/607f57011b539e243e7bf38b3efaa641.svg" align="middle" width="552.2747999999999pt" height="40.118265pt"/></p>

where <img alt="$\bar{\boldsymbol{\kappa}}=\sum_{i}\kappa_{i}$" src="svgs/ddcfc639f5d2847d625209d5f49aad65.svg" align="middle" width="72.57789pt" height="24.65792999999999pt"/>, <img alt="$\bar{\boldsymbol{\omega}}=\sum_{i}\omega_{i}$" src="svgs/ef14c3f4e26f0d5a120ec12dd1e410ee.svg" align="middle" width="74.77337999999999pt" height="24.65792999999999pt"/> and <img alt="$\hat{\boldsymbol{\Omega}}$" src="svgs/2a3ab68ef92dc243a5cb17c2652c14fa.svg" align="middle" width="13.652925000000005pt" height="31.23318000000001pt"/> is the normalizing kernel and <img alt="$\hat{\boldsymbol{\kappa}}$" src="svgs/82a2876744811576e71f0ab7111387f9.svg" align="middle" width="10.974150000000005pt" height="23.287769999999995pt"/> is normalized version of <img alt="$\boldsymbol{\kappa}$" src="svgs/6e848e87c58070305a54149f9affd6a4.svg" align="middle" width="10.974150000000005pt" height="14.61206999999998pt"/>. 

### Full conditional distributions

The posterior of <img alt="$\boldsymbol{\beta}$" src="svgs/b40aa6b23d5447452eba56d9bda8960d.svg" align="middle" width="11.404140000000002pt" height="22.831379999999992pt"/> follows a <img alt="$p$" src="svgs/2ec6e630f199f589a2402fdf3e0289d5.svg" align="middle" width="8.270625000000004pt" height="14.155350000000013pt"/>-dimensional multivariate distribution 

<p align="center"><img alt="$$&#10;\begin{align*}&#10;\left[\boldsymbol{\beta}\mid\cdots\right] &amp; \sim\text{MVN}\left(\boldsymbol{Q}_{\beta}^{-1}\boldsymbol{\ell}_{\beta},\boldsymbol{Q}_{\beta}^{-1}\right),\\&#10;\boldsymbol{Q}_{\beta} &amp; =\boldsymbol{X}^{T}\hat{\boldsymbol{\Omega}}\boldsymbol{X}+\boldsymbol{H},\\&#10;\boldsymbol{\ell}_{\beta} &amp; =\boldsymbol{X}^{T}\hat{\boldsymbol{\kappa}},&#10;\end{align*}&#10;$$" src="svgs/d0ec79b7b6029850d34e76d5f3b122da.svg" align="middle" width="235.28834999999998pt" height="84.393045pt"/></p>
given <img alt="$\boldsymbol{H}=\diag\left(\left[\eta_{1},\eta_{2},\cdots,\eta_{p}\right]\right)$" src="svgs/0c48e8a2e10a6a4f0676cd1179571091.svg" align="middle" width="154.744095pt" height="24.65759999999998pt"/>.

The posterior of <img alt="$\eta_{k}$" src="svgs/714be8ecb02963528032a5c59dbf053f.svg" align="middle" width="15.428325000000003pt" height="14.155350000000013pt"/> follows a Gamma distribution

<p align="center"><img alt="$$&#10;\left[\eta_{k}\mid\cdots\right]\sim\text{Gamma}\left(1,\frac{1}{2}\beta_{k}^{2}+\gamma_{k}\right).&#10;$$" src="svgs/cb12ac09387fc84c3824e3447bbaca68.svg" align="middle" width="255.81765pt" height="39.45249pt"/></p>


The posterior of <img alt="$\gamma_{k}$" src="svgs/0be70542d78d255d114877bcf3e2b091.svg" align="middle" width="15.776805000000003pt" height="14.155350000000013pt"/> follows a Gamma distribution

<p align="center"><img alt="$$&#10;\left[\gamma_{k}\mid\cdots\right]\sim\text{Gamma}\left(1,\eta_{k}+\tau_{A}\right).&#10;$$" src="svgs/3ece87b3fcc79dbf50aeab68b49aee71.svg" align="middle" width="232.5906pt" height="16.438356pt"/></p>
The posterior of <img alt="$\tau_{A}$" src="svgs/7f66c79ccfda0e9ea18d262c5b47afaa.svg" align="middle" width="17.072055000000002pt" height="14.155350000000013pt"/> follows a truncated Gamma distribution

<p align="center"><img alt="$$&#10;\left[\tau_{A}\mid\cdots\right]\sim\text{Gamma}_{\left[0.01,\infty\right)}\left(\frac{p}{2},\sum_{j=1}^{p}\gamma_{j}\right).&#10;$$" src="svgs/30129260e677dc13d9cfb495ab859619.svg" align="middle" width="291.80249999999995pt" height="59.178735pt"/></p>
The condition distributions for overdispersion parameter <img alt="$r$" src="svgs/89f2e0d2d24bcf44db73aab8fc03252c.svg" align="middle" width="7.873024500000003pt" height="14.155350000000013pt"/>, <img alt="$\beta_{0}$" src="svgs/e8d30649c24cb89c455c87c02aea1c55.svg" align="middle" width="15.850560000000003pt" height="22.831379999999992pt"/> and for each <img alt="$\omega_{i}$" src="svgs/77f4562694389a02269cf98f9fce3bbc.svg" align="middle" width="14.883165000000004pt" height="14.155350000000013pt"/>  are the same as the paper.